!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},r=e.parcelRequire3642;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in a){let r=a[e];delete a[e];let n={id:e,exports:{}};return t[e]=n,r.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},e.parcelRequire3642=r);var n,o=r("77woC"),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(r("IYGjQ")),i=(n=r("unafd"))&&n.__esModule?n:{default:n};function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(c=function(e){return e?a:t})(e)}var s;s={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/".concat("f161cdfdab09","/{locale}.json")};var u,d=r("2iUxv"),p=(o=r("77woC"),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=_(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(r("IYGjQ")));r.register("8aOon",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=n?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(r,l,i):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(r("IYGjQ")),n=function(e){return e&&e.__esModule?e:{default:e}}(r("OJQRv"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}const l={},i={},c=e=>t=>Promise.all([t.get("board","private","selected-slack"),a.myTeams(t)]).then((([a,r])=>{if(!r||0===r.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:c(e)}),null;if(a){const e=r.find((e=>e.id===a));if(e)return e}return r[0]})).then((r=>{if(!r)return null;if(l[r.id])return l[r.id];if(i[r.id])return Promise.resolve(t.popup({items:i[r.id],title:t.localizeKey("choose_a_channel"),search:{count:15,placeholder:t.localizeKey("search_for_a_channel"),empty:t.localizeKey("no_channels_found")}}));const o=Promise.all([a.getStars(t,r.id),a.getSlackUserConversations(t,r.id)]).then((([a,o])=>{const s=o.map((t=>({...t,text:"".concat(t.isPrivate?"ðŸ”’ ":"#").concat(t.name),callback:a=>e(a,t,r)}))).sort(((e,t)=>{const r=a.find((t=>t.channel===e.id)),n=a.find((e=>e.channel===t.id));return r&&!n?-1:!r&&n?1:e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0})),u={text:t.localizeKey("choose_a_different_team"),callback:n.default(c(e)),alwaysVisible:!0};return s.push(u),i[r.id]=s,l[r.id]=null,t.popup({items:s,title:t.localizeKey("choose_a_channel"),search:{count:15,placeholder:t.localizeKey("search_for_a_channel"),empty:t.localizeKey("no_channels_found")}})}));return l[r.id]=o,o}));var s=c;e.exports.default=s})),r.register("OJQRv",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var a=r("2iUxv"),n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=n?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(r,l,i):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(r("IYGjQ"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}var l=e=>t=>n.myTeams(t).then((r=>{if(!r||0===r.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:t=>t.get("board","private","selected-slack").then((a=>e(t,{id:a})))});const n=r.map((r=>a.extend(r,{text:r.name,callback:a=>t.set("board","private","selected-slack",r.id).then((()=>e(a,r)))}))),o={text:"Add Slack Team",callback:t=>t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:t=>t.get("board","private","selected-slack").then((a=>e(t,{id:a})))}),alwaysVisible:!0};return n.push(o),t.popup({items:n,title:t.localizeKey("choose_slack_team"),search:{count:15}})}));e.exports.default=l}));var f=g(r("8aOon"));r.register("7kqDO",(function(e,t){"use strict";Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.default=void 0;var a=r("2iUxv"),n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(r("IYGjQ")),o=function(e){return e&&e.__esModule?e:{default:e}}(r("OJQRv"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}const i=TrelloPowerUp.Promise,c=e=>t=>i.join(t.get("board","private","selected-slack"),n.myTeams(t)).spread(((r,n)=>{if(!n||0===n.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:c(e)}),null;if(r){const e=a.find(n,["id",r]);if(e)return e}return n[0]})).then((r=>r?n.getMembers(t,r.id).then((n=>{const l=n.map((t=>{const n=t.real_name?"@".concat(t.name," (").concat(t.real_name,")"):"@".concat(t.name);return a.extend(t,{text:n,callback:a=>e(a,t,r)})})),i={text:t.localizeKey("choose_a_different_team"),callback:o.default(c(e)),alwaysVisible:!0};return l.push(i),t.popup({items:l,title:t.localizeKey("choose_user_ellipsis"),search:{count:15,placeholder:t.localizeKey("search_for_a_user"),empty:t.localizeKey("no_users_found")}})})):null));var s=c;e.exports.default=s}));var h=g(r("7kqDO")),m=g(r("OJQRv")),y=g(r("79Byh"));function g(e){return e&&e.__esModule?e:{default:e}}function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(_=function(e){return e?a:t})(e)}function b(e,t){o.sendUIEvent({action:"clicked",actionSubject:"button",actionSubjectId:t,source:"cardDetailScreen"},e)}const v=(e,t,a)=>e.card("id").then((r=>p.sendCard(e,r.id,a.id,t.id).then((()=>{if(t.id.startsWith("C")||t.id.startsWith("G")){const r={...t,team:{id:a.id,domain:a.domain}};e.set("board","private","last-channel",r)}e.popup({title:e.localizeKey("message_sent"),url:"app.html?page=message-sent",args:{target:t,team:a}})})))),k=(e,t)=>a=>a.popup({title:a.localizeKey("choose_a_time"),url:"choose-time.html",args:{target:e,team:t}}),w=(e,t,a)=>{const r=e.localizeKeys(["three_minutes","ten_minutes","one_hour","three_hours","one_day","two_days","three_days","seven_days","fourteen_days","thirty_days"]);return e.popup({title:"me"===t.name?e.localizeKey("remind_you_when"):e.localizeKey("remind_name_when",{name:t.name}),items:[{text:e.localizeKey("choose_a_time_ellipsis"),callback:k(t,a)}].concat(["3 minutes","10 minutes","1 hour","3 hours","1 day","2 days","3 days","7 days","14 days","30 days"].map(((n,o)=>({text:e.localizeKey("remind_in_interval",{interval:r[o]}),callback:y.default(t,a,"in ".concat(n))}))))})},O=(e,t)=>w(e,{name:"me",id:"me"},t);u=e=>e.get("board","private","last-channel").then((t=>{b(e,"slackPowerUpCardButton");const a=[t instanceof Object&&"string"==typeof t.name&&{text:e.localizeKey("send_to_specific_channel",{channel:t.name,isPrivate:t.isPrivate?"ðŸ”’ ":"#"}),callback:a=>p.myTeams(a).then((r=>d.find(r,["id",t.team.id])?v(a,t,t.team):a.popup({title:e.localizeKey("authorize"),url:"./app.html?page=authorization",callback:e=>e.back()})))},{text:e.localizeKey("send_to_channel"),callback:e=>(b(e,"slackPowerUpSendToChannelButton"),f.default(v)(e))},{text:e.localizeKey("send_via_direct_message"),callback:e=>(b(e,"slackPowerUpSendDMButton"),h.default(v)(e))},{text:e.localizeKey("attach_conversation_ellipsis"),callback:e=>(b(e,"slackPowerUpAttachConversationButton"),(e=>e.popup({title:e.localizeKey("attach_conversation"),url:"attach-conversation.html"}))(e))},{text:e.localizeKey("remind_me_about_card"),callback:e=>(b(e,"slackPowerUpRemindMeButton"),m.default(O)(e))},{text:e.localizeKey("remind_someone_about_card"),callback:e=>(b(e,"slackPowerUpRemindSomeoneButton"),h.default(w)(e))},{text:e.localizeKey("remind_channel_about_card"),callback:e=>(b(e,"slackPowerUpRemindChannelButton"),f.default(w)(e))}];return e.popup({items:a,title:e.localizeKey("slack")})}));var z,j=r("1VA0K");z=(e,t)=>e.length>t?"".concat(e.slice(0,t).replace(/\s*\S+$/,""),"â€¦"):e;const P=window.outerHeight-200,x={accentColor:"#425381",url:"app.html?page=settings",title:"Slack",height:P>625?P:625},M="./images/icon.svg",{Promise:K}=window.TrelloPowerUp,{sha256Digest:U}=window.TrelloPowerUp.util.crypto;window.TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{const a=t.entries.filter((e=>j.isMessage(e.url)));return 0===a.length?[]:(o.sendUIEvent({action:"viewed",actionSubject:"section",actionSubjectId:"slackPowerUpSection",source:"cardDetailScreen"},e),[{claimed:a,icon:M,title:e.localizeKey("slack_conversations"),content:{type:"iframe",url:e.signUrl("./messages.html"),height:64}}])},"board-buttons":e=>(K.join(e.get("organization","private","token"),e.get("board","shared","token")).spread(((t,a)=>{t&&(console.log("Migrating team level token"),l.linkUser(e,t).then((()=>e.remove("organization","private","token")))),a&&(console.log("Migrating board level token"),l.linkUser(e.boardToken).then((()=>e.remove("board","private","token"))))})),[{icon:M,text:e.localizeKey("slack"),callback:t=>{o.sendUIEvent({action:"clicked",actionSubject:"button",actionSubjectId:"slackPowerUpBoardButton",source:"boardScreen"},e),t.modal(x)}}]),"card-buttons":e=>[{icon:M,text:e.localizeKey("slack"),callback:u}],"card-from-url":(e,t)=>{const{url:a}=t;if(!j.isMessage(t.url))throw e.NotHandled("Not a Slack message URL");return l.dataForUrl(e,a,!0).catch((()=>{throw e.NotHandled("Error getting data for URL")})).then((t=>{if(t&&t.formatted)return{name:z(t.formatted,128),desc:t.formatted};if(t&&t.messages.length>0){const r=t.messages[0].text||t.messages[0].attachments[0].fallback;return i.default.getMessageText(e,r,t).then((async e=>{try{const t=await U(a);localStorage.setItem("slack:url:".concat(t),e)}catch(e){}return{name:z(e,128),desc:e}})).catch((()=>{throw e.NotHandled("Error formatting message")}))}throw e.NotHandled("No data for URL")}))},"format-url":(e,t)=>{if(!j.isMessage(t.url))throw e.NotHandled("Not a Slack message URL");const a=/archives\/(.*)\//g.exec(t.url)[1];return/^[D|G]/g.test(a)?{text:t.url,icon:M}:l.dataForUrl(e,t.url,!0).catch((()=>{throw e.NotHandled("Error getting data for URL")})).then((a=>{if(a&&a.formatted)return{text:z(a.formatted,128),icon:M};if(a&&a.messages.length>0){const r=a.messages[0].text||a.messages[0].attachments[0].fallback;return i.default.getMessageText(e,r,a).then((async e=>{try{const a=await U(t.url);localStorage.setItem("slack:url:".concat(a),e)}catch(e){}return{text:z(e,128),icon:M}})).catch((()=>{throw e.NotHandled("Error formatting message")}))}throw e.NotHandled("No data for URL")}))},"show-settings":e=>e.modal(x)},{targetOrigin:"https://trello.com",localization:s,Sentry:window.Sentry})}();
//# sourceMappingURL=index.e364ed01.js.map
