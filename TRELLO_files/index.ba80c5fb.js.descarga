!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},i={},r=e.parcelRequire3642;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in i){let r=i[e];delete i[e];let l={id:e,exports:{}};return t[e]=l,r.call(l.exports,l,l.exports),l.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){i[e]=t},e.parcelRequire3642=r);var l,o,a=r("2Sw9I");a=r("2Sw9I");const n=/^https?:\/\/(?:[\w-]+\.)?(?:app\.)?box\.com\//,d=e=>n.test(e),s=e=>{const t={url:e};if(!d(e))return t;t.isBox=!0;const i=e.replace(n,"").replace(/#.*$/,"").split("?")[0].split("/");return"s"===i[0]?(t.isShareLink=!0,/\?folder=true$/.test(e)?t.isFolder=!0:/\?folder=false$/.test(e)&&(t.isFile=!0)):"files"===i[0]&&(i.length<6&&i.length>3&&"f"===i[2]?(t.isFolder=!0,t.folderId=i[3]):i.length>5&&0===i[5].indexOf("f_")&&(t.isFile=!0,t.fileId=i[5].substring(2))),t};o={parse:s,isBox:d,isFolder:(e,t)=>{const i=s(t);return!!i.isFolder||!i.isFile&&(!!i.isShareLink&&a.getSharedItem(e,t,{fields:"type"}).then((e=>"folder"===e.type)))}};const u=TrelloPowerUp.Promise;l=(e,t,i,r={})=>u.try((()=>{const i=o.parse(t);if(!i.isBox)throw e.NotHandled("not a box url");if(i.isFile&&i.fileId)return u.all([a.getFile(e,i.fileId,{fields:"id,name,type,created_at,modified_at,modified_by"}),u.try((()=>r.thumbnail?a.getThumbnail(e,i.fileId):null))]).spread(((e,t)=>({image:{url:t,y:"top",size:"contain"},title:e.name,created:Date.parse(e.created_at),modified:Date.parse(e.modified_at),modifiedBy:e.modified_by.name})));if(i.isFolder&&i.folderId)return a.getFolder(e,i.folderId,{fields:"id,name,type,created_at,modified_at,modified_by"}).then((e=>({title:e.name,created:Date.parse(e.created_at),modified:Date.parse(e.modified_at),modifiedBy:e.modified_by.name,id:e.id})));if(i.isShareLink){const t=i.url.replace("?folder=true","").replace("?folder=false","");return a.getSharedItem(e,t,{fields:"id,name,type,created_at,modified_at,modified_by,size,type"}).then((i=>u.try((()=>"file"===i.type&&r.thumbnail?a.getThumbnail(e,i.id,t):null)).then((e=>({image:{url:e,y:"top",size:"contain"},title:i.name,created:Date.parse(i.created_at),modified:Date.parse(i.modified_at),modifiedBy:i.modified_by.name,id:i.id,size:i.size,type:i.type}))).catch((()=>{var e;return{title:i.name,created:Date.parse(i.created_at),modified:Date.parse(i.modified_at),modifiedBy:null===(e=i.modified_by)||void 0===e?void 0:e.name,id:i.id,size:i.size,type:i.type}}))))}throw e.NotHandled("not a box url")}));var c;c=e=>e.popup({title:e.localizeKey("box"),url:"./attach.html",height:30});var f,m=r("2CJtd");f={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/".concat("c6f51ca0ecaf","/{locale}.json")};var p;p=e=>{const t=[" Bytes"," KB"," MB"," GB"," TB"," PB"];for(let i=1;i<t.length;i++)if(e<Math.pow(1024,i))return Math.round(e/Math.pow(1024,i-1)*100)/100+t[i-1];return e};const h=TrelloPowerUp.Promise,y="./images/icon.svg";TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{const i=t.entries;return h.filter(i,(t=>o.isFolder(e,t.url))).then((t=>0===t.length?[]:h.map((e=>{const t={};return e.filter((e=>!t[e.url]&&(t[e.url]=!0,!0)))})(t),(t=>{const i=l(e,t.url,t.name).get("title").then((t=>t&&!/^https:/.test(t)?t:e.localizeKey("box_folder"))).catch(m,(()=>t.name&&!/^https?:/.test(t.name)?t.name:e.localizeKey("box_folder")));return{id:t.id,claimed:[t],icon:y,title:()=>i,content:{type:"iframe",url:e.signUrl("./folder.html",{url:t.url}),height:480}}})))).catch(m,(()=>[]))},"attachment-thumbnail":(e,t)=>l(e,t.url,t.name,{thumbnail:!0}).then((i=>{if(!i)throw new m.Unknown;const r=i;return i.image&&i.image.url||(r.image={url:y,logo:!0}),r.url=t.url,r.openText=e.localizeKey("open_in_box"),r})).catch(m.Unauthorized,m.CouldNotRefresh,(()=>({image:{url:y,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box"),initialize:{type:"iframe",url:e.signUrl(TrelloPowerUp.util.relativeUrl("authorize-link.html"))}}))).catch(m,(()=>{if(o.isBox(t.url))return{image:{url:y,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box")};throw e.NotHandled()})),"card-buttons":e=>e.memberCanWriteToModel("card")?[{icon:y,text:e.localizeKey("box"),callback:c}]:[],"format-url":async(e,t)=>{if(!o.isBox(t.url))throw e.NotHandled("Not a formattable URL");try{const{title:i,size:r,image:o,type:a}=await l(e,t.url,t.name,{thumbnail:!0});let n=p(r);return"folder"===a&&(n=0===r?e.localizeKey("empty_folder"):"".concat(e.localizeKey("folder")," ").concat(p(r))),{icon:y,text:i,subtext:n,...o.url?{thumbnail:o.url}:{}}}catch(i){if(i instanceof m&&o.isBox(t.url))return{icon:y,text:t.name||t.url};throw e.NotHandled()}}},{targetOrigin:"https://trello.com",localization:f,Sentry:window.Sentry})}();
//# sourceMappingURL=index.ba80c5fb.js.map
